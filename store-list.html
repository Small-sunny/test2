<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords" content="admin, dashboard, bootstrap, template, flat, modern, theme, responsive, fluid, retina, backend, html5, css, css3">
    <meta name="description" content="">
    <meta name="author" content="ThemeBucket">
    <link rel="shortcut icon" href="#" type="image/png">

    <title>admin</title>

    <!--icheck-->
    <link href="js/iCheck/skins/minimal/minimal.css" rel="stylesheet">
    <link href="js/iCheck/skins/square/square.css" rel="stylesheet">
    <link href="js/iCheck/skins/square/red.css" rel="stylesheet">
    <link href="js/iCheck/skins/square/blue.css" rel="stylesheet">

    <!--dashboard calendar-->
    <link href="css/clndr.css" rel="stylesheet">

    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="js/morris-chart/morris.css">

    <!--common-->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet">
    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
    <style>
        .header-section{
            background-color: #65CEA7;
        }
        .wrapper .panel-heading{
            background-color: #65CEA7;
        }
        hr{
            margin: 0;
        }
        .notification-menu{
            float: right;
        }
        .notification-menu li{
            float: right;
        }
        .notification-menu a{
            color:#fff;
        }
        .notification-menu a:hover{
            color:#65CEA7;
        }
        #orders{
            background-image: none;
        }
    </style>

</head>

<body class="sticky-header">

<section>
    <!-- left side start-->
    <div class="left-side sticky-left-side">

        <!--logo and iconic logo start-->
        <div class="logo">
            <ul class="notification-menu">
                <li>
                    <a  href="#" class="btn dropdown-toggle" data-toggle="dropdown">
                        <img src="images/photos/user-avatar.png" alt="" />
                        <span id="uname">登录</span>
                        <span class="caret"></span>
                    </a>
                    <ul id="user" class="dropdown-menu dropdown-menu-usermenu pull-right">
                        <li><a href="#" disabled="true"><i class="fa fa-user"></i>修改密码</a></li>
                        <!--<li><a href="#"><i class="fa fa-cog"></i>  Settings</a></li>-->
                        <li><a disabled="true" onclick="loginOut();"><i class="fa fa-sign-out"></i>退出</a></li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="logo-icon text-center">

        </div>
        <!--logo and iconic logo end-->
        <div class="left-side-inner">
            <ul class="nav nav-pills nav-stacked custom-nav">
                <li class="menu-list active"><a href="index.html"><i class="fa fa-laptop"></i> <span>门店管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a onclick="allstore();">所有门店类型</a></li>
                        <li class="active"><a onclick="allstorelist();">所有门店列表</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a id="orders" onclick="allOrderlist();"><i class="fa fa-folder"></i> <span>所有订单列表</span></a>
                </li>

            </ul>
            <!--sidebar nav end-->
        </div>
    </div>
    <!-- left side end-->

    <!-- main content start-->
    <div class="main-content" >

        <!-- header section start-->
        <div class="header-section">

            <!--toggle button start-->
            <a class="toggle-btn"><i class="fa fa-bars"></i></a>
            <!--toggle button end-->

            <!--search start-->
            <form class="searchform" action="index.html" method="post">
                <input type="text" class="form-control" name="keyword" placeholder="Search here..." />
            </form>
            <!--search end-->

            <!--notification menu start  右侧登录信息-->
            <!--<div class="menu-right">
                <ul class="notification-menu">
                    <li>
                        <a  href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                            <img src="images/photos/user-avatar.png" alt="" />
                            <span id="uname">登录</span>
                            <span class="caret"></span>
                        </a>
                        <ul id="user" class="dropdown-menu dropdown-menu-usermenu pull-right">
                            <li><a href="#" disabled="true"><i class="fa fa-user"></i>修改密码</a></li>
                            &lt;!&ndash;<li><a href="#"><i class="fa fa-cog"></i>  Settings</a></li>&ndash;&gt;
                            <li><a disabled="true" onclick="loginOut();"><i class="fa fa-sign-out"></i>退出</a></li>
                        </ul>
                    </li>
                </ul>
            </div>-->
            <!--notification menu end -->

        </div>
        <!-- header section end-->

        <!-- page heading start-->
        <div class="page-heading">
            <h3>门店管理</h3>
            <ul class="breadcrumb">
                <li class="active">所有门店列表</li>
            </ul>

        </div>
        <!-- page heading end-->
        <hr/>

        <!--body wrapper start-->
        <div class="wrapper">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-success">
                        <div class="panel-heading">所有门店</div>
                        <div class="panel-body">
                            <a class="btn btn-success" data-toggle="modal" data-target="#myModal1">
                            <span class="glyphicon glyphicon-share-alt"></span>&nbsp;添加门店
                        </a>
                            <table class="table table-striped table-hover" id="storelist">
                                <thead>
                                <tr>
                                    <th>门店ID</th>
                                    <th>门店名称</th>
                                    <th>门店简称</th>
                                    <th>门店地址</th>
                                    <th>门店类型</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!--<tr>
                                    <td>11111</td>
                                    <td>第八天影院</td>
                                    <td>第八天</td>
                                    <td>广东省 深圳市 宝安区</td>
                                    <td>影院 </td>
                                    <td>
                                        <a class="btn btn-success" data-toggle="modal" data-target="#myModal1">
                                            <span class="glyphicon glyphicon-share-alt"></span>&nbsp;新增
                                        </a>
                                        <a class="btn btn-success" data-toggle="modal" data-target="#myModal">
                                            <span class="glyphicon glyphicon-edit"></span>&nbsp;修改
                                        </a>
                                        <<a class="btn btn-success" onclick="deleteById();">&nbsp;删除</a>
                                    </td>
                                </tr>-->
                                </tbody>
                            </table>
                            <!--新增-->
                            <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-body">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                                &times;
                                            </button>
                                            <div class=" form">
                                                <form class="cmxform form-horizontal adminex-form" action="">
                                                    <div class="form-group ">
                                                        <label for="sname" class="control-label col-lg-4">门店名称：</label>
                                                        <div class="col-lg-6">
                                                            <input class=" form-control" id="sname"  type="text"  value=""/>
                                                        </div>
                                                    </div>
                                                    <div class="form-group ">
                                                        <label for="ssname" class="control-label col-lg-4">门店简称：</label>
                                                        <div class="col-lg-6">
                                                            <input class=" form-control"  id="ssname" type="text" value=""/>
                                                        </div>
                                                    </div>
                                                    <div class="form-group ">
                                                        <label for="sadd" class="control-label col-lg-4">门店地址：</label>
                                                        <div class="col-lg-6">
                                                            <input class=" form-control" id="sadd"  type="text"  value=""/>
                                                        </div>
                                                    </div>
                                                    <div class="form-group ">
                                                        <label for="stype" class="control-label col-lg-4">门店类型id：</label>
                                                        <div class="col-lg-6">
                                                            <select id="stype" class=" form-control">

                                                            </select>

                                                            <!--<input class=" form-control" id="stype"  type="text"  value=""/>-->
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-lg-4"></label>
                                                        <div class="col-lg-6">
                                                            <button class="btn btn-success" type="button" onclick="addstore();">提交</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>
                            <!--修改-->
                            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-body">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                                &times;
                                            </button>
                                            <div class=" form">
                                                <form class="cmxform form-horizontal adminex-form" action="">
                                                    <div class="form-group ">
                                                        <label for="sid" class="control-label col-lg-4">门店ID：</label>
                                                        <div class="col-lg-6">
                                                            <input class=" form-control" id="sid"  type="text"  value=""/>
                                                        </div>
                                                    </div>
                                                    <div class="form-group ">
                                                        <label for="dname" class="control-label col-lg-4">门店名称：</label>
                                                        <div class="col-lg-6">
                                                            <input class=" form-control" id="dname"  type="text"  value=""/>
                                                        </div>
                                                    </div>
                                                    <div class="form-group ">
                                                        <label for="shortname" class="control-label col-lg-4">门店简称：</label>
                                                        <div class="col-lg-6">
                                                            <input class=" form-control"  id="shortname" type="text" value=""/>
                                                        </div>
                                                    </div>
                                                    <div class="form-group ">
                                                        <label for="address" class="control-label col-lg-4">门店地址：</label>
                                                        <div class="col-lg-6">
                                                            <input class=" form-control" id="address"  type="text"  value=""/>
                                                        </div>
                                                    </div>
                                                    <div class="form-group ">
                                                        <label for="type" class="control-label col-lg-4">门店类型ID：</label>
                                                        <div class="col-lg-6">
                                                            <select id="type" class=" form-control">

                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-lg-4"></label>
                                                        <div class="col-lg-6">
                                                            <button class="btn btn-success" type="button" onclick="updateStore();">提交</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>

                                        </div>
                                    </div>

                                </div><!-- /.modal-content -->
                            </div><!-- /.modal -->




                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--body wrapper end-->

    </div>
    <!-- main content end-->
</section>

<!-- Placed js at the end of the document so the pages load faster -->
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/modernizr.min.js"></script>
<script src="js/jquery.nicescroll.js"></script>


<!--easy pie chart-->
<script src="js/easypiechart/jquery.easypiechart.js"></script>
<script src="js/easypiechart/easypiechart-init.js"></script>

<!--Sparkline Chart-->
<script src="js/sparkline/jquery.sparkline.js"></script>
<script src="js/sparkline/sparkline-init.js"></script>

<!--icheck -->
<script src="js/iCheck/jquery.icheck.js"></script>
<script src="js/icheck-init.js"></script>

<!--Calendar-->
<!--
<script src="js/calendar/clndr.js"></script>
<script src="js/calendar/evnt.calendar.init.js"></script>
<script src="js/calendar/moment-2.2.1.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
-->

<!--common scripts for all pages-->

<script src="js/scripts.js"></script>
<script type="text/javascript" src="js/jquery.cookies.js"></script>
<script src="js/baiduTemplate.js"></script>
<script type="text/html" id="t:table">
    <@ console.log(data.length);@>
    <@ for (var i = 0; i < data.length; i++){ @>

    <tr>
        <td><@=data[i].id@></td>
        <td><@=data[i].name@></td>
        <td><@=data[i].shortName@></td>
        <td><@=data[i].address@></td>
        <td><@=data[i].storeType.name@> </td>
        <td>
            <!--<a class="btn btn-success" data-toggle="modal" data-target="#myModal1">
                <span class="glyphicon glyphicon-share-alt"></span>&nbsp;新增
            </a>-->
            <a id="update" class="btn btn-success" data-toggle="modal"  data-target="#myModal" onclick="storeinfo('<@=data[i].id@>')">
                <span class="glyphicon glyphicon-edit"></span>&nbsp;修改
            </a>
            <a class="btn btn-success" onclick="deleteById('<@=data[i].id@>');">&nbsp;删除</a>
        </td>
    </tr>
    <@}@>


</script>
<script type="text/html" id="t1:table">
    <option value="">请选择</option>
    <@ for (var i = 0; i < data.length; i++){ @>
    <option value="<@=data[i].id@>">
        <@=data[i].name@>
    </option>
    <@}@>
</script>

<script>
    var bt=baidu.template;
    var userName;
    function getuserName(name) {
        var reg1 = new RegExp("(^|&)" + name + "=([^&]*)(&|;)", "i");
        //	    var r = window.location.search.substr(1).match(reg);
        var r1 = decodeURI(window.location.search.substr(1)).match(reg1);
        if (r1 != null) return unescape(r1[2]); return null;
    }
    userName = getuserName("userName");
    var jsessionid;
    //获取jsessionid
    function getSessionid(name) {
        var reg = new RegExp("(^|;)" + name + "=([^;]*)(;|$)", "i");
        //	    var r = window.location.search.substr(1).match(reg);
        var r = decodeURI(window.location.search.substr(1)).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }
    jsessionid=getSessionid("jsessionid");
    console.log(jsessionid);
    function allstore(){
        window.location="index.html?userName="+userName+";jsessionid="+jsessionid;
    }
    function allstorelist(){
        location.reload();
    }
    function allOrderlist(){
        window.location.href = 'order.html?userName='+userName+';jsessionid='+jsessionid;
    }
    /*function login(userName,passwd) {
        $.post('http://192.168.0.217:8888//web/user/login?userName' +userName+ '&passwd=' + passwd, null, function (data) {
            console.log(data);
            var result=eval('('+data+')');
            if (result.code== 0) {
                if(userName=='admin'){
                    $('#uname').html(userName+ ' (管理员)');
                }else{
                    $('#uname').html(userName+ ' (用户)');
                }
            } else {
                window.location.href = 'login.html';
            }
        })
    }*/
    function checkLogin(){
        userName = getuserName("userName");
        console.log(userName);
        if(userName != null){
            $('#uname').html(userName);
            //$('#user').css("display","block");
        }
    }
    checkLogin();

    function loginOut(){
        $.post("http://192.168.0.217:8888//web/user/logout",null,function(data){
            var result=eval('('+data+')');
            if(result.code== 0){
                $('#uname').html('登录');
                //location.reload();
                //console.log($('#uname').html());
                window.location.href = 'login.html';
            }else{
                alert("请求错误！");
            }
        })

    }
    /*获取门店列表*/
    function getStore(pageNum,size) {
        $.get('http://192.168.0.217:8888//web/store/storeEntity/list;jsessionid='+jsessionid+'?pageNum='+pageNum+'&size='+size,null,function(result){
            var result=eval('('+result+')');
            console.log(result);
            //debugger;
            if(result.code == 0){
                var tableHtml=bt('t:table',result);
                $('#storelist tbody').html();
                $('#storelist tbody').html(tableHtml);
                var pagecode = getpagecode(result.pageInfo.totalCount,result.pageInfo.currentPageNum,result.pageInfo.currentSize);
                $("#footer").html("");
                $("#footer").html(pagecode);
            }else{
                alert("请求错误！");
                window.location.href = 'login.html';
            }
        })
    }
    getStore(1,10);
    function getpagecode(totalNum,currentPage,pageSize){
        var totalPage=totalNum%pageSize==0?parseInt(totalNum/pageSize):parseInt(totalNum/pageSize)+1;
        //		    	alert("totalpage"+totalPage+"currentPage"+currentPage);
        var pageCode = "<ul class='pagination pagination-sm no-margin pull-right'>";
        pageCode = pageCode + "<li><a pageNum='1' onclick='initdata(1,"+pageSize+")'>首页</a></li>";
        if(currentPage==1){
            pageCode = pageCode + "<li class='disabled'><a href='#'>上一页</a></li>";
        }else{
            pageCode = pageCode + "<li><a pageNum='"+(currentPage-1)+"' onclick='initdata("+(currentPage-1)+","+pageSize+")'>上一页</a></li>";
        }
        for(var i=currentPage-2;i<=currentPage+2;i++){
            if(i<1||i>totalPage){
                continue;
            }
            if(i==currentPage){
                pageCode = pageCode + "<li class='active'><a href='#'>"+i+"</a></li>";
            }else{
                pageCode = pageCode + "<li><a pageNum='"+i+"' onclick='initdata("+i+","+pageSize+")'>"+i+"</a></li>";
            }
        }
        if(currentPage==totalPage){
            pageCode = pageCode + "<li class='disabled'><a href='#'>下一页</a></li>";
        }else{
            pageCode = pageCode + "<li><a pageNum='"+(currentPage+1)+"' onclick='initdata("+(currentPage+1)+","+pageSize+")'>下一页</a></li>";
        }
        pageCode = pageCode + "<li><a pageNum='"+totalPage+"' onclick='initdata("+totalPage+","+pageSize+")'>尾页</a></li>";
        pageCode = pageCode + "</ul>";
        if(totalNum == 0)
            pageCode="";
        return pageCode
    }
    /**/
    /*var urls = "http://192.168.0.217:8888//web/store/storeEntity;jsessionid=" + jsessionid + '?pageNum=1&size=10';
     $.ajax({
     url: urls,
     type: "GET",
     success: function (result) {
     var result = eval('(' + result + ')');
     console.log(result);
     //debugger;
     if (result.code == 0) {
     var tableHtml = bt('t:table', result);
     $('#storelist tbody').html();
     $('#storelist tbody').html(tableHtml);
     } else {
     alert("请求错误！");
     //window.location.href = 'login.html';
     }
     }

     })*/
    /*获取所有门店类型*/
    function getStypeAll(){
        $.get('http://192.168.0.217:8888//web/store/storeTypeAll;jsessionid='+jsessionid,null,function(data){
            var result=eval('('+data+')');
            //console.log(result);
            if(result.code == 0){
                //console.log(result.data);
                var tableHtml1=bt('t1:table',result);
                $('#stype').html();
                $('#stype').html(tableHtml1);
                $('#type').html();
                $('#type').html(tableHtml1);

            }else{
                alert("请求错误~~！");
                //window.location.href = 'login.html';
            }
        })
    }
    getStypeAll();



    /*添加门店*/
    function addstore() {
        var sname,addshortname,address1,stype1;
        //sID=$("#sid").val();
        sname=$("#sname").val();
        addshortname=$("#ssname").val();
        address1=$("#sadd").val();
        stype1=$("#stype option:selected").val();
        if(sname==''){
            alert('门店名称不能为空!');
            return;
        }
        if(addshortname==''){
            alert('门店简称不能为空!');
            return;
        }
        if(address1==''){
            alert('门店地址不能为空!');
            return;
        }if(stype1==''){
            alert('门店类型不能为空!');
            return;
        }
        var url1 = "http://192.168.0.217:8888//web/store/storeEntity;jsessionid="+jsessionid+"?name="+sname+"&shortName="+addshortname+
                "&address="+address1+"&storeTypeId="+stype1;
        $.ajax({
            url: url1,
            type:"POST",
            data: {_method: 'PUT'},
            success: function (data) {
                var result=eval('('+data+')');
                console.log(result);
                if(result.code==0){
                    alert('添加成功！');
                    window.location.reload();
                }else{
                    alert('添加失败！错误原因：'+result.msg);
                }
            }
        })
    }
    /*修改门店信息*/
     function storeinfo(storeId){
         var url2 = "http://192.168.0.217:8888//web/store/storeEntity;jsessionid="+jsessionid+"/"+storeId;
         $.ajax({
             url: url2,
             type:"GET",
             dataType:"json",
             success: function (result) {
                 alert(result);
                 console.log(result);
                 console.log(result.data.storeType.id);
                 console.log(result.code);
                 $("#sid").val(result.data.id);
                 $("#dname").val(result.data.name);
                 $("#shortname").val(result.data.shortName);
                 $("#address").val(result.data.address);
                 $("#type option:selected").val(result.data.storeType.id);
                 //$('#update').add("data-target","#myModal");
             }
         });
     }
    /*修改提交*/
    function updateStore(){
        var sID,dname,shortname,address,stype;
        sID=$("#sid").val();
        dname=$("#dname").val();
        shortname=$("#shortname").val();
        address=$("#address").val();
        stype=$("#type option:selected").val();
        if(sID==''){
            alert('门店ID不能为空!');
            return;
        }
        if(dname==''){
            alert('门店名称不能为空!');
            return;
        }
        if(shortname==''){
            alert('门店简称不能为空!');
            return;
        }
        if(address==''){
            alert('门店地址不能为空!');
            return;
        }if(stype==''){
            alert('门店类型不能为空!');
            return;
        }


        $.post('http://192.168.0.217:8888//web/store/storeEntity;jsessionid='+jsessionid+
                '?name='+dname+'&shortName='+shortname+'&address='+address+'&storeTypeId='+stype+'&id='+sID,null,function(result){
            console.log(sID);
            console.log(dname);
            console.log(shortname);
            console.log(address);
            console.log(stype);

            var result=eval('('+result+')');
            if(result.code == 0){
                alert('修改成功！');
                window.location.reload();
            }else{
                alert("请求错误！");
                //window.location.href = 'login.html';
            }
        })
    }
    /*删除*/
    function deleteById(storeId){
        //console.log(storeId);
        if(confirm("确认删除吗?")){
            var url3 = "http://192.168.0.217:8888//web/store/storeEntity;jsessionid="+jsessionid+"?id="+storeId;
            $.ajax({
                url: url3,
                type:"POST",
                data: {_method: 'DELETE'},
                success: function (result) {
                    //console.log(result);
                    /*console.log($(this));*/
                    $(this).parent().parent().remove();

                    alert('删除成功！');
                    getStore(1,10);
                }
            });
        }
        else{
            return ;
        }
    }
</script>
</body>
</html>
